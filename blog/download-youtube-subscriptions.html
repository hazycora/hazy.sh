<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon.png" />
		<link rel="stylesheet" href="/fonts/style.css" />
		<meta name="viewport" content="width=device-width" />
		<script defer data-domain="hazy.sh" src="https://conscious.besties.house/js/script.js"></script>
		
		<link href="../_app/immutable/assets/app.ByGc3s2F.css" rel="stylesheet">
		<link href="../_app/immutable/assets/layout.DQowY_Z0.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.Bh7GeAvR.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/entry.C5qUNYON.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/scheduler.CZZf4ebe.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.CRXNbddx.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.D9yZW6-G.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.CKjEzDrg.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/2.DWG3rHeI.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/6.D_uez9bl.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/spread.CgU5AtxT.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/layout.uwIBflyf.js"><title>Downloading YouTube subscriptions in CSV format with web scraping - hazy.sh</title><!-- HEAD_svelte-d8fcqf_START --><link rel="preload" as="image" href="/wallpaper.jpg"><!-- HEAD_svelte-d8fcqf_END --><!-- HEAD_svelte-22vd3i_START --><link rel="preconnect" href="https://ws.audioscrobbler.com/"><meta name="description" content="Because Google Takeout takes too long"><meta property="og:site_name" content="hazy.sh"><meta property="og:type" content="article"><meta property="og:title" content="Downloading YouTube subscriptions in CSV format with web scraping"><meta property="og:description" content="Because Google Takeout takes too long"><meta name="fediverse:creator" content="@h@besties.house"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Downloading YouTube subscriptions in CSV format with web scraping"><meta property="twitter:site" content="@hazycora"><meta property="twitter:description" content="Because Google Takeout takes too long"><!-- HEAD_svelte-22vd3i_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">    <div class="page"><nav data-svelte-h="svelte-19myjvv"><a href="/">hazy.sh</a> <a href="/blog">other blog posts</a></nav> <article class="svelte-1o629bw"><div class="article-top svelte-1o629bw"> <div class="article-top-content svelte-1o629bw"><h1 class="svelte-1o629bw">Downloading YouTube subscriptions in CSV format with web scraping</h1>  <time itemprop="datePublished" datetime="2022-05-23T00:00:00.000Z" class="svelte-1o629bw">May 23, 2022</time></div></div> <p data-svelte-h="svelte-oar4td">Hey! This was posted <a href="https://dev.to/hazy/downloading-your-youtube-subscriptions-in-csv-format-because-google-takeout-takes-too-long-5ca1" rel="nofollow">on my dev.to profile back in 2022</a>. Apparently it was shared on Reddit, and for archival’s sake I’m reposting it here, two years later! The rest of the article is pretty much just as I wrote it in 2022. Excuse poor writing and atrocious code formatting, it’s been a bit!</p> <hr> <p data-svelte-h="svelte-19jexpc">I wanted to import my YouTube subscriptions into the <a href="https://newpipe.net/" rel="nofollow">open-source Android YouTube client NewPipe</a>. The normal way to do that is to export the subscriptions from Google Takeout, a service Google provides to allow you to retrieve data about your account. NewPipe kindly explains the process:</p> <p data-svelte-h="svelte-1vbj5pr"><img src="/assets/downloading-youtube-subscriptions/instructions.webp" alt="Screenshot of the NewPipe app's explanation on how to use Google Takeout."></p> <p data-svelte-h="svelte-cp4q1h"><em>Excuse the comic sans, it’s my favorite font.</em></p> <p data-svelte-h="svelte-1qz4uwj">NewPipe’s instructions are as follows:</p> <blockquote data-svelte-h="svelte-n6laaw"><p>Import YouTube subscriptions from Google takeout:</p> <ol><li>Go to this URL: <a href="https://takeout.google.com/takeout/custom/youtube" rel="nofollow">https://takeout.google.com/takeout/custom/youtube</a></li> <li>Log in when asked</li> <li>Click on “All data included”, then on “Deselect all”, then select only “subscriptions” and click “OK”</li> <li>Click on “Next step” and then on “Create export”</li> <li>Click on the “Download” button after it appears</li> <li>Click on IMPORT FILE below and select the downloaded .zip file</li> <li>[If the .zip import fails] Extract the .csv file (usually under “YouTube and YouTube Music/subscriptions/subscriptions.csv”), click on IMPORT FILE below and select the extracted csv file</li></ol></blockquote> <p data-svelte-h="svelte-zvu33f">What they neglect to mention is that Google Takeout can take many hours to complete.</p> <p data-svelte-h="svelte-7tf5kk">I tried using Google Takeout, but after an hour of waiting, I decided I’d try something else. I would scrape the list of channels I’m subscribed to, and I’d save that list as a CSV file I can import into NewPipe.</p> <h2 id="finding-out-how-the-google-takeout-csv-is-formatted" data-svelte-h="svelte-1xd0c1i"><a class="header-link" href="#finding-out-how-the-google-takeout-csv-is-formatted"><span class="icon icon-link"></span></a>Finding out how the Google Takeout CSV is formatted</h2> <p data-svelte-h="svelte-tydq1s">In order to make my own file that NewPipe would accept as though it were a Google Takeout CSV, I had to find out the format Google Takeout uses.</p> <p data-svelte-h="svelte-vgikds">I found <a href="https://github.com/TeamNewPipe/NewPipeExtractor/pull/709/commits/94a29fd63ff6bb0c1805c44ef5ebf4d915427454" rel="nofollow">the PR</a> that added the Google Takeout importing support. Inside that commit was a description of the file.</p> <pre class="language-java"><!-- HTML_TAG_START --><code class="language-java"><span class="token comment">// Expected format of CSV file:</span>
<span class="token comment">//      Channel Id,Channel Url,Channel Title</span>
<span class="token comment">//      UC1JTQBa5QxZCpXrFSkMxmPw,http://www.youtube.com/channel/UC1JTQBa5QxZCpXrFSkMxmPw,Raycevick</span>
<span class="token comment">//      UCFl7yKfcRcFmIUbKeCA-SJQ,http://www.youtube.com/channel/UCFl7yKfcRcFmIUbKeCA-SJQ,Joji</span>
<span class="token comment">//</span>
<span class="token comment">// Notes:</span>
<span class="token comment">//      It's always 3 columns</span>
<span class="token comment">//      The first line is always a header</span>
<span class="token comment">//      Header names are different based on the locale</span>
<span class="token comment">//      Fortunately the data is always the same order no matter what locale</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-kwk8mj">This was simple enough. Now I needed to find out how to get a list of the Channel ID and Channel Title of each of the channels I’m subscribed to.</p> <h2 id="youtube-scraping" data-svelte-h="svelte-narute"><a class="header-link" href="#youtube-scraping"><span class="icon icon-link"></span></a>YouTube scraping</h2> <p data-svelte-h="svelte-nhyrf5">I found a page on YouTube <a href="https://www.youtube.com/feed/channels" rel="nofollow">that lists all the channels you’re subscribed to</a>. I got to looking at how this page worked, and realized that the page stores data inside a variable called ytInitialData. This variable stores the list of the channels you’re subscribed to, as well as some other data. YouTube paginates the list, though, so the variable won’t always have everything right off the bat. YouTube loads more of the list whenever you scroll to the bottom of the page, though, which means I can just automate the scrolling.</p> <p data-svelte-h="svelte-1q8oozr">Another bit of data included in the ytInitialData variable is the API token required to load the rest of the list. And when the list is fully loaded, the token is removed from ytInitialData.</p> <p data-svelte-h="svelte-1syg3lx">This means I can check if that token exists in order to know whether to keep scrolling down.</p> <p data-svelte-h="svelte-19ut2qs">I wrote a script to scroll to the bottom of the page by checking the height of the container <code>&lt;div&gt;</code> and then scrolling with the function <code>window.scrollTo</code>.</p> <p data-svelte-h="svelte-dxmmnp">I then wrote a script to get the Channel IDs and Channel Titles from this list. I would also need the Channel URL, but this was as easy as adding the channel ID after the string <code>&quot;http://www.youtube.com/channel/&quot;</code>. It then joined the data of all the channels one by one. Finally, it would log the data to the console.</p> <p data-svelte-h="svelte-1nuyke8">I combined these scripts and ran them together. It worked.</p> <p data-svelte-h="svelte-1a7jmi0">To make it just a bit more convenient, I made another script which made a <code>&lt;div&gt;</code> to put the CSV data in. This <code>&lt;div&gt;</code> would use <code>position: fixed</code> to cover the screen.</p> <p data-svelte-h="svelte-1t2t7k8">To make it even easier to use, I decided to make a download button to save the text as a file so you wouldn’t need to copy-paste it yourself.</p> <h2 id="the-script" data-svelte-h="svelte-pex0bo"><a class="header-link" href="#the-script"><span class="icon icon-link"></span></a>The script</h2> <p data-svelte-h="svelte-1s79ct">Here’s my code:</p> <pre class="language-js"><!-- HTML_TAG_START --><code class="language-js"><span class="token keyword">function</span> <span class="token function">getLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> ytInitialData<span class="token punctuation">.</span>contents<span class="token punctuation">.</span>twoColumnBrowseResultsRenderer<span class="token punctuation">.</span>tabs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tabRenderer<span class="token punctuation">.</span>content<span class="token punctuation">.</span>sectionListRenderer<span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>
		<span class="token operator">-</span><span class="token number">1</span>
	<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">canContinue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token function">getLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>continuationItemRenderer <span class="token operator">!=</span> <span class="token keyword">null</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">canContinue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">let</span> current <span class="token operator">=</span>
			<span class="token function">getLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>continuationItemRenderer<span class="token punctuation">.</span>continuationEndpoint
				<span class="token punctuation">.</span>continuationCommand<span class="token punctuation">.</span>token
		<span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'primary'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scrollHeight<span class="token punctuation">)</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>
			<span class="token function">canContinue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
			current <span class="token operator">==</span>
				<span class="token function">getLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>continuationItemRenderer<span class="token punctuation">.</span>continuationEndpoint
					<span class="token punctuation">.</span>continuationCommand<span class="token punctuation">.</span>token
		<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token keyword">let</span> floatDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
	<span class="token keyword">let</span> preText <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'pre'</span><span class="token punctuation">)</span>
	floatDiv<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>
		<span class="token string">'style'</span><span class="token punctuation">,</span>
		<span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">position: fixed;
		background: #0f0f0f;
		z-index: 100000;
		inset: 2rem;
		overflow: auto;
		font-size: 2rem;
		white-space: pre;
		color: white;
		padding: 1rem;</span><span class="token template-punctuation string">&#96;</span></span>
	<span class="token punctuation">)</span>
	<span class="token keyword">let</span> csvText <span class="token operator">=</span>
		<span class="token string">'Channel Id,Channel Url,Channel Title&#92;n'</span> <span class="token operator">+</span>
		ytInitialData<span class="token punctuation">.</span>contents<span class="token punctuation">.</span>twoColumnBrowseResultsRenderer<span class="token punctuation">.</span>tabs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tabRenderer<span class="token punctuation">.</span>content<span class="token punctuation">.</span>sectionListRenderer<span class="token punctuation">.</span>contents
			<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>itemSectionRenderer<span class="token punctuation">)</span> <span class="token keyword">return</span>
				<span class="token keyword">return</span> e<span class="token punctuation">.</span>itemSectionRenderer<span class="token punctuation">.</span>contents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shelfRenderer<span class="token punctuation">.</span>content
					<span class="token punctuation">.</span>expandedShelfContentsRenderer<span class="token punctuation">.</span>items
			<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>channelRenderer<span class="token punctuation">)</span>
					<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>e<span class="token punctuation">.</span>channelRenderer<span class="token punctuation">.</span>channelId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,http://www.youtube.com/channel/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>e<span class="token punctuation">.</span>channelRenderer<span class="token punctuation">.</span>channelId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>e<span class="token punctuation">.</span>channelRenderer<span class="token punctuation">.</span>title<span class="token punctuation">.</span>simpleText<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span>
				<span class="token keyword">return</span> <span class="token string">''</span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&#92;n'</span><span class="token punctuation">)</span>
	preText<span class="token punctuation">.</span>innerText <span class="token operator">=</span> csvText
	<span class="token keyword">let</span> downloadLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
	downloadLink<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Download CSV'</span>
	downloadLink<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">)</span>
	downloadLink<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>
		<span class="token string">'style'</span><span class="token punctuation">,</span>
		<span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">color: #bf3838;
		font-weight: bold;
		margin-bottom: 1rem;
		display: block;
		padding: 1rem;
		border-radius: 0.5rem;
		border: 2px solid #bf3838;
		width: fit-content;
		text-decoration: none;</span><span class="token template-punctuation string">&#96;</span></span>
	<span class="token punctuation">)</span>
	<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>csvText<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	downloadLink<span class="token punctuation">.</span>href <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
	floatDiv<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>downloadLink<span class="token punctuation">)</span>
	floatDiv<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>preText<span class="token punctuation">)</span>
	document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>floatDiv<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <p data-svelte-h="svelte-1rlbmgp">You can run this in DevTools at <a href="https://www.youtube.com/feed/channels" rel="nofollow">youtube.com/feed/channels</a>. You can then save the file by clicking “Download CSV”.</p> <p data-svelte-h="svelte-318ohg"><img src="/assets/downloading-youtube-subscriptions/screenshot.jpeg" alt="A red button reading 'Download CSV', above a list of YouTube Channel IDs and Channel URLs."></p> <h2 id="conclusion" data-svelte-h="svelte-14u6bd9"><a class="header-link" href="#conclusion"><span class="icon icon-link"></span></a>Conclusion</h2> <p data-svelte-h="svelte-u3nau9">By the time I had finished writing the script, Google Takeout still hadn’t sent me a download of my subscriptions list. I eventually received this download hours later, but by that point I had already imported my own list into NewPipe and no longer needed theirs.</p> <p data-svelte-h="svelte-1a7wwmx">My guess is that Google Takeout runs on a queue, sending one person their data and then the next, rather than working on each request immediately.</p> <p data-svelte-h="svelte-bbev5b">I hope you find my script useful. If you make any improvements, you can let me know in the comments of my <a href="https://gist.github.com/hazycora/bc41e673aff4c9c7846d80e145574285" rel="nofollow">GitHub gist</a> about this script.</p></article> </div> 
			
			<script>
				{
					__sveltekit_pi9gd7 = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [{"type":"data","data":null,"uses":{}},{"type":"data","data":null,"uses":{}},null];

					Promise.all([
						import("../_app/immutable/entry/start.Bh7GeAvR.js"),
						import("../_app/immutable/entry/app.CRXNbddx.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 6],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
