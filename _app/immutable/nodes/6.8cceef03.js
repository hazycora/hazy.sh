import{S as tt,i as st,s as at,N as Le,y as nt,z as it,A as ot,O as rt,P as Qe,g as lt,d as pt,B as ct,Q as ze,k as n,q as u,a as f,l as i,m as r,r as h,h as t,c as d,K as Ze,n as p,b as o,E as s,I as ut}from"../chunks/index.afbbbedd.js";import{L as ht}from"../chunks/layout.3c8c4adb.js";function ft(q){let l,k,w,b,c,m,y,B,Ae,K,v,E,D,le,Q,H,pe,z,R,ce,Z,S,ue,X,P,Ye=`<code class="language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> detectedTwitter <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'user-agent'</span><span class="token punctuation">]</span>
		<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'Twitterbot/'</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>detectedTwitter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// redirect to the page to be displayed on Twitter</span>
		res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'https://discord.com'</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// handle request for other users</span>
	<span class="token comment">// malicious sites could serve a phishing site right here</span>
	res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'https://example.com'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code>`,Y,$,C,Ue,ee,T,I,F,he,te,_,fe,L,de,me,A,ke,we,se,g,W,G,be,_e,j,V,ye,ae,x,ge,U,ve,Te,ne,M,J,xe,ie,N,Ee;return{c(){l=n("p"),k=u("(I’m not the first to find this problem. It’s been known since 2019, I link to other articles and blog posts that came before me at the end.)"),w=f(),b=n("p"),c=u("When you link to something at the end of a Tweet, the link isn’t displayed. Instead, you’ll only see a “summary card” Twitter generates when a post is made. The domain name of the URL is displayed in these cards, so at face value they don’t make phishing easier."),m=f(),y=n("p"),B=n("img"),K=f(),v=n("h2"),E=n("a"),D=n("span"),le=u("their implementation is Not Perfect"),Q=f(),H=n("p"),pe=u(`If a link redirects to another page, Twitter follows that redirect and displays the domain name of the destination instead of the original URL. This is fine, it means the cards will reflect the same page users will see.
But the user isn’t sent directly to the destination- When someone clicks one of these cards, they go to the original URL. For typical redirect links, that’s okay, because the redirect Twitter experiences will we the same as the user’s redirect. But what if a malicious site serves a different redirect to users than to Twitter?`),z=f(),R=n("p"),ce=u("When Twitter fetches the page content in order to generate these cards, they set the HTTP “User-Agent” header to begin with “Twitterbot/”, so it can be detected on our website that the request was for Twitter. Setting custom User-Agents for things like this is normal, it means sites can customise the text of embeds for specific sites if necessary or block Twitter from making these requests if desired, but for malicious sites it also allows us to exploit this issue reliably."),Z=f(),S=n("p"),ue=u("Here’s an example of an ExpressJS route that detects Twitter and redirects to discord.com, while redirecting to example.com for everyone else:"),X=f(),P=n("pre"),Y=f(),$=n("p"),C=n("img"),ee=f(),T=n("h2"),I=n("a"),F=n("span"),he=u("this issue is old"),te=f(),_=n("p"),fe=u("Twitter has had this issue for years, and I’m by no means the first to notice it. It’s "),L=n("a"),de=u("been known since 2019"),me=u(" at the latest. My friend "),A=n("a"),ke=u("Lexi"),we=u(" found the same issue a couple years ago, and she told me it reported this to Twitter through HackerOne, but the exploit still hasn’t been fixed."),se=f(),g=n("div"),W=n("div"),G=n("p"),be=u("twitters bbp is a joke, fixing things is not their strong suit"),_e=f(),j=n("div"),V=n("p"),ye=u("Lmao"),ae=f(),x=n("p"),ge=u("BleepingComputer "),U=n("a"),ve=u("wrote on this in 2019"),Te=u(" and contacted Twitter about it, to no response."),ne=f(),M=n("blockquote"),J=n("p"),xe=u("BleepingComputer reached out to Twitter for a statement about this problem and if it would be fixed in the near future but received no reply at the time of publishing."),ie=f(),N=n("p"),Ee=u("Hopefully Twitter realises the severity of this problem. Be careful when clicking links- the suggestion to check URLs before clicking is a good one, but it’s not infallible!"),this.h()},l(e){l=i(e,"P",{});var a=r(l);k=h(a,"(I’m not the first to find this problem. It’s been known since 2019, I link to other articles and blog posts that came before me at the end.)"),a.forEach(t),w=d(e),b=i(e,"P",{});var qe=r(b);c=h(qe,"When you link to something at the end of a Tweet, the link isn’t displayed. Instead, you’ll only see a “summary card” Twitter generates when a post is made. The domain name of the URL is displayed in these cards, so at face value they don’t make phishing easier."),qe.forEach(t),m=d(e),y=i(e,"P",{});var Be=r(y);B=i(Be,"IMG",{src:!0,alt:!0}),Be.forEach(t),K=d(e),v=i(e,"H2",{id:!0});var Pe=r(v);E=i(Pe,"A",{class:!0,href:!0});var He=r(E);D=i(He,"SPAN",{class:!0}),r(D).forEach(t),He.forEach(t),le=h(Pe,"their implementation is Not Perfect"),Pe.forEach(t),Q=d(e),H=i(e,"P",{});var Re=r(H);pe=h(Re,`If a link redirects to another page, Twitter follows that redirect and displays the domain name of the destination instead of the original URL. This is fine, it means the cards will reflect the same page users will see.
But the user isn’t sent directly to the destination- When someone clicks one of these cards, they go to the original URL. For typical redirect links, that’s okay, because the redirect Twitter experiences will we the same as the user’s redirect. But what if a malicious site serves a different redirect to users than to Twitter?`),Re.forEach(t),z=d(e),R=i(e,"P",{});var Se=r(R);ce=h(Se,"When Twitter fetches the page content in order to generate these cards, they set the HTTP “User-Agent” header to begin with “Twitterbot/”, so it can be detected on our website that the request was for Twitter. Setting custom User-Agents for things like this is normal, it means sites can customise the text of embeds for specific sites if necessary or block Twitter from making these requests if desired, but for malicious sites it also allows us to exploit this issue reliably."),Se.forEach(t),Z=d(e),S=i(e,"P",{});var $e=r(S);ue=h($e,"Here’s an example of an ExpressJS route that detects Twitter and redirects to discord.com, while redirecting to example.com for everyone else:"),$e.forEach(t),X=d(e),P=i(e,"PRE",{class:!0});var et=r(P);et.forEach(t),Y=d(e),$=i(e,"P",{});var Ce=r($);C=i(Ce,"IMG",{src:!0,alt:!0}),Ce.forEach(t),ee=d(e),T=i(e,"H2",{id:!0});var Ie=r(T);I=i(Ie,"A",{class:!0,href:!0});var We=r(I);F=i(We,"SPAN",{class:!0}),r(F).forEach(t),We.forEach(t),he=h(Ie,"this issue is old"),Ie.forEach(t),te=d(e),_=i(e,"P",{});var O=r(_);fe=h(O,"Twitter has had this issue for years, and I’m by no means the first to notice it. It’s "),L=i(O,"A",{href:!0,rel:!0});var je=r(L);de=h(je,"been known since 2019"),je.forEach(t),me=h(O," at the latest. My friend "),A=i(O,"A",{href:!0,rel:!0});var Me=r(A);ke=h(Me,"Lexi"),Me.forEach(t),we=h(O," found the same issue a couple years ago, and she told me it reported this to Twitter through HackerOne, but the exploit still hasn’t been fixed."),O.forEach(t),se=d(e),g=i(e,"DIV",{class:!0});var oe=r(g);W=i(oe,"DIV",{class:!0});var Ne=r(W);G=i(Ne,"P",{});var Oe=r(G);be=h(Oe,"twitters bbp is a joke, fixing things is not their strong suit"),Oe.forEach(t),Ne.forEach(t),_e=d(oe),j=i(oe,"DIV",{class:!0});var De=r(j);V=i(De,"P",{});var Fe=r(V);ye=h(Fe,"Lmao"),Fe.forEach(t),De.forEach(t),oe.forEach(t),ae=d(e),x=i(e,"P",{});var re=r(x);ge=h(re,"BleepingComputer "),U=i(re,"A",{href:!0,rel:!0});var Ge=r(U);ve=h(Ge,"wrote on this in 2019"),Ge.forEach(t),Te=h(re," and contacted Twitter about it, to no response."),re.forEach(t),ne=d(e),M=i(e,"BLOCKQUOTE",{});var Ve=r(M);J=i(Ve,"P",{});var Je=r(J);xe=h(Je,"BleepingComputer reached out to Twitter for a statement about this problem and if it would be fixed in the near future but received no reply at the time of publishing."),Je.forEach(t),Ve.forEach(t),ie=d(e),N=i(e,"P",{});var Ke=r(N);Ee=h(Ke,"Hopefully Twitter realises the severity of this problem. Be careful when clicking links- the suggestion to check URLs before clicking is a good one, but it’s not infallible!"),Ke.forEach(t),this.h()},h(){Ze(B.src,Ae="/assets/twitter-summary-card-phishing/card-example-domain-highlighted.png")||p(B,"src",Ae),p(B,"alt","A Tweet displaying a summary card linking to discord.com"),p(D,"class","icon icon-link"),p(E,"class","header-link"),p(E,"href","#their-implementation-is-not-perfect"),p(v,"id","their-implementation-is-not-perfect"),p(P,"class","language-js"),Ze(C.src,Ue="/assets/twitter-summary-card-phishing/demo.gif")||p(C,"src",Ue),p(C,"alt","An animated GIF showing a Tweet that looks to contain a link to Discord, but sends users to example.com instead"),p(F,"class","icon icon-link"),p(I,"class","header-link"),p(I,"href","#this-issue-is-old"),p(T,"id","this-issue-is-old"),p(L,"href","https://shkspr.mobi/blog/2019/03/scammers-abusing-twitter-cards-via-redirects/"),p(L,"rel","nofollow"),p(A,"href","https://twitter.com/1lexxi"),p(A,"rel","nofollow"),p(W,"class","received"),p(j,"class","sent"),p(g,"class","dm"),p(U,"href","https://www.bleepingcomputer.com/news/security/twitter-can-be-tricked-into-showing-misleading-embedded-links/"),p(U,"rel","nofollow")},m(e,a){o(e,l,a),s(l,k),o(e,w,a),o(e,b,a),s(b,c),o(e,m,a),o(e,y,a),s(y,B),o(e,K,a),o(e,v,a),s(v,E),s(E,D),s(v,le),o(e,Q,a),o(e,H,a),s(H,pe),o(e,z,a),o(e,R,a),s(R,ce),o(e,Z,a),o(e,S,a),s(S,ue),o(e,X,a),o(e,P,a),P.innerHTML=Ye,o(e,Y,a),o(e,$,a),s($,C),o(e,ee,a),o(e,T,a),s(T,I),s(I,F),s(T,he),o(e,te,a),o(e,_,a),s(_,fe),s(_,L),s(L,de),s(_,me),s(_,A),s(A,ke),s(_,we),o(e,se,a),o(e,g,a),s(g,W),s(W,G),s(G,be),s(g,_e),s(g,j),s(j,V),s(V,ye),o(e,ae,a),o(e,x,a),s(x,ge),s(x,U),s(U,ve),s(x,Te),o(e,ne,a),o(e,M,a),s(M,J),s(J,xe),o(e,ie,a),o(e,N,a),s(N,Ee)},p:ut,d(e){e&&t(l),e&&t(w),e&&t(b),e&&t(m),e&&t(y),e&&t(K),e&&t(v),e&&t(Q),e&&t(H),e&&t(z),e&&t(R),e&&t(Z),e&&t(S),e&&t(X),e&&t(P),e&&t(Y),e&&t($),e&&t(ee),e&&t(T),e&&t(te),e&&t(_),e&&t(se),e&&t(g),e&&t(ae),e&&t(x),e&&t(ne),e&&t(M),e&&t(ie),e&&t(N)}}}function dt(q){let l,k;const w=[q[0],Xe];let b={$$slots:{default:[ft]},$$scope:{ctx:q}};for(let c=0;c<w.length;c+=1)b=Le(b,w[c]);return l=new ht({props:b}),{c(){nt(l.$$.fragment)},l(c){it(l.$$.fragment,c)},m(c,m){ot(l,c,m),k=!0},p(c,[m]){const y=m&1?rt(w,[m&1&&Qe(c[0]),m&0&&Qe(Xe)]):{};m&2&&(y.$$scope={dirty:m,ctx:c}),l.$set(y)},i(c){k||(lt(l.$$.fragment,c),k=!0)},o(c){pt(l.$$.fragment,c),k=!1},d(c){ct(l,c)}}}const Xe={image:"/assets/twitter-summary-card-phishing/card-example.png",imageAlt:"A Tweet displaying a summary card linking to discord.com",title:"Twitter's cards have a bug that makes phishing easy",description:"Sites linked to on Twitter can pretend to be any other URL",date:"2023-06-03T00:00:00.000Z"};function mt(q,l,k){return q.$$set=w=>{k(0,l=Le(Le({},l),ze(w)))},l=ze(l),[l]}class bt extends tt{constructor(l){super(),st(this,l,mt,dt,at,{})}}export{bt as component};
